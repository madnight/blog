<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0">
    <meta name="author" content="Fabian Beuke">
    <link href="/fav.png" as="image" onload="this.rel='shortcut icon'" sizes="45x48">
    <noscript>
        <link rel="shortcut icon" sizes="45x48" href="/fav.png">
    </noscript>
    <link rel="icon" href="/fav.png" onload="if(media!='all')media='all'">
    <noscript>
        <link rel="icon" href="/fav.png">
    </noscript>
    <title>beuke.org</title>
    <meta name="description" content="A personal blog about computer science and theoretical physics.">
    <link rel="alternate" type="application/rss+xml" title="beuke.org" href="/atom.xml" onload="if(media!='all')media='all'">
    <noscript>
        <link rel="alternate" type="application/rss+xml" title="beuke.org" href="/atom.xml">
    </noscript>
    <link rel="preload" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" as="style">
    <link rel="stylesheet" href="/css/simple.css/simple.min.css" as="style">
    <link rel="stylesheet" href="/css/main.css" onload="if(media!='all')media='all'">
    <noscript>
        <link rel="stylesheet" href="/css/main.css">
    </noscript>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" media="none" onload="if(media!='all')media='all'">
    <noscript>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    </noscript>
    <link rel="stylesheet" href="/css/light.css" media="(prefers-color-scheme: light)">
    <link rel="stylesheet" href="/css/dark.css" media="(prefers-color-scheme: dark)">
    <!--<script src="https://googlechromelabs.github.io/dark-mode-toggle/src/dark-mode-toggle-stylesheets-loader.js"></script>-->
    <script data-goatcounter="https://beuke.goatcounter.com/count" async src="/js/goatcounter.js"></script>
    <script type="module" src="https://unpkg.com/dark-mode-toggle"></script>
    <script defer type="text/javascript">
        document.addEventListener("DOMContentLoaded", function (event)
        {
            //- fix for single quotes in pre blocks
            document.body.innerHTML = document.body.innerHTML.replaceAll('', '\'');
        });
    </script>
    <script defer src="/js/table-wrapper.js"></script>
    <meta name="generator" content="Hexo 6.3.0">
</head>


    <header>
    <nav>
        
        <a href="/"> Home</a>
        
        <a href="https://github.com/madnight"> Github</a>
        
        <a href="/archive/"> Archive</a>
        
        <a href="/about/"> About</a>
        
    </nav>
<div class="title-con">
    <div class="title-container">
        <h1>beuke.org</h1>
        <dark-mode-toggle id="dark-mode-toggle-1" appearance="toggle"></dark-mode-toggle>
    </div>
</div>
    <h2>A personal blog exploring computer science and theoretical physics</h2>
</header>


    <body>
    <main>
            <article>
    <section>
        <div class="post-title"> Arch Linux Versioned </div>
        <div class="post-subtitle"> Arch Linux Date-Based Versioned Upgrades </div>
        <div class="post-subsubtitle"> Posted on
        Jun 21 2021 ~
        3 min read</div>
        <div class="post-subtitle-tags">
        
        <a href="/tags/arch/">#arch</a>Â 
        
        <a href="/tags/linux/">#linux</a>Â 
        
        <a href="/tags/upgrades/">#upgrades</a>Â 
        
        </div>
        
        <hr class="solid">
    </section>
    <div class"content">
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Have you ever been in the situation that you just wanted to install a single new package, but pacman couldnâ€™t find it, because your local package database is outdated? If so then you usually have two options. Perform a full system upgrade with <code>pacman -Syu</code><sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Pacman Upgrading Packages](https://wiki.archlinux.org/title/Pacman#Upgrading_packages)
">[1]</span></a></sup> and a potential reboot in case of a new kernel or do a partial upgrade. Upgrade your local package database and only install the package plus all itâ€™s dependencies in the newest version. The problem is that partial upgrades are unsupported<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Arch Linux System Maintenance](https://wiki.archlinux.org/title/System_maintenance#Upgrading_the_system)
">[2]</span></a></sup>. Therefore, sooner than later, you might end up with a broken installation (missing .so files, wrong glibc version, kernel does not bootâ€¦). This might not be a big deal for a seasoned Archer. All you have to do is to arch-chroot from a live USB stick (some might have a Arch Linux Live USB stick always plugged in just in case) and fix the system. But this is at least time consuming and maybe a bit annoying. However, thereâ€™s a third, lesser known option.</p>
<h1 id="arch-linux-archive"><a class="markdownIt-Anchor" href="#arch-linux-archive"></a> Arch Linux Archive</h1>
<p>The Arch Linux Archive (ALA), stores official repositories snapshots, iso images and bootstrap tarballs across time. It keeps packages for a few years on a daily bases. The most common use case for ALA is a full system downgrade in case something went wrong. With the Arch Linux Archive you are <strong>able to pin down all your packages to a specific point in time</strong> by defining the ALA as your only mirror in the pacman mirrorlist. This allows you to install any package from core, extra or community even if you are letâ€™s say 2 month behind the current Arch Linux upstream.</p>
<h1 id="setup"><a class="markdownIt-Anchor" href="#setup"></a> Setup</h1>
<p>Replace your <code>/etc/pacman.d/mirrorlist</code> with the following content:<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Arch Linux Archive](https://wiki.archlinux.org/title/Arch_Linux_Archive#How_to_restore_all_packages_to_a_specific_date)
">[3]</span></a></sup></p>
<figure class="highlight"><pre><font face="monospace">##
## Arch Linux repository mirrorlist
## Generated on 2042-01-01
##
Server=<a href="https://archive.archlinux.org/repos/2042/01/01/$repo/os/$arch">https://archive.archlinux.org/repos/2042/01/01/$repo/os/$arch</a>
</font></pre></figure>
<p>And replace the date <code>2042/01/01</code> with the current date or any date you wish (>=2014). Now you are always able to install any package without upgrading. But, upgrading you should. Since <code>pacman -Syu</code> will not offer any new updates you have to update your mirror first. You could either manually edit the mirrorlist bump the date and <code>pacman -Syu</code> again or you can put the following bash function in you <code>.bashrc</code> or <code>.zshrc</code> which will do that for you automatically:</p>
<figure class="highlight"><pre><font face="monospace"><font color="#ffd75f">upgrade() {</font>
Â Â Â Â <font color="#af87af">YESTERDAY</font><font color="#87afaf">=</font><font color="#afaf5f">$(</font><font color="#87afd7">date</font><font color="#afaf5f">Â </font><font color="#afaf5f">-d</font><font color="#afaf5f">Â </font>"<font color="#afaf5f">yesterday</font>"<font color="#afaf5f">Â +</font><font color="#afaf5f">%Y/%m/%d</font><font color="#afaf5f">)</font>
Â Â Â Â <font color="#af87af">MIRROR</font><font color="#87afaf">=</font>"<font color="#afaf5f"><a href="https://archive.archlinux.org/repos">https://archive.archlinux.org/repos</a></font>"

Â Â Â Â <font color="#87afd7">echo</font><font color="#afaf5f">Â </font>"<font color="#afaf5f">Server =Â </font><font color="#af87af">$MIRROR</font><font color="#afaf5f">/</font><font color="#af87af">$YESTERDAY</font><font color="#afaf5f">/</font><font color="#afaf5f">\$</font><font color="#afaf5f">repo/os/</font><font color="#afaf5f">\$</font><font color="#afaf5f">arch</font>"<font color="#afaf5f">Â \</font>
<font color="#afaf5f">Â Â Â Â Â Â Â </font><font color="#87afaf">|</font>Â <font color="#87afd7">sudo</font>Â <font color="#87afd7">tee</font>Â /etc/pacman.d/mirrorlist
Â Â Â Â <font color="#87afd7">sudo</font>Â pacmanÂ <font color="#afaf5f">-Syu</font>
<font color="#ffd75f">}</font>
</font></pre></figure>
<h2 id="references"><a class="markdownIt-Anchor" href="#references"></a> References</h2>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a href="https://wiki.archlinux.org/title/Pacman#Upgrading_packages">Pacman Upgrading Packages</a><a href="#fnref:1" rev="footnote"> â†©</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a href="https://wiki.archlinux.org/title/System_maintenance#Upgrading_the_system">Arch Linux System Maintenance</a><a href="#fnref:2" rev="footnote"> â†©</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a href="https://wiki.archlinux.org/title/Arch_Linux_Archive#How_to_restore_all_packages_to_a_specific_date">Arch Linux Archive</a><a href="#fnref:3" rev="footnote"> â†©</a></span></li></ol></div></div>
    </div>
</article>

    </main>
        <footer>
    <p>This blog was made with <a href="https://hexo.io/">Hexo</a> and <a href="https://simplecss.org">Simple.css</a>.<br>
    Content is available under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 </a> unless noted otherwise.</p>
    <p>

        <a href="/atom.xml">
        <svg class="icon" aria-hidden="true" width="16" height="16" viewbox="0 -1 16 16" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor" d="M4.259 23.467c-2.35 0-4.259 1.917-4.259 4.252 0 2.349 1.909 4.244 4.259 4.244 2.358 0 4.265-1.895 4.265-4.244-0-2.336-1.907-4.252-4.265-4.252zM0.005 10.873v6.133c3.993 0 7.749 1.562 10.577 4.391 2.825 2.822 4.384 6.595 4.384 10.603h6.16c-0-11.651-9.478-21.127-21.121-21.127zM0.012 0v6.136c14.243 0 25.836 11.604 25.836 25.864h6.152c0-17.64-14.352-32-31.988-32z" transform="scale(0.46)"/></svg>RSS Feed</a>

    â€¢ <a href="https://github.com/madnight/blog"><svg class="icon" aria-hidden="true" width="16" height="16" viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="currentColor"/>
</svg>Source</a>
    </p>
    </footer>

    </body>
</html>
